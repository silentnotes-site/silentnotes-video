<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SilentNotes Videos</title>
<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Inter,Arial;
background:linear-gradient(135deg,#ff0080,#7928ca,#2afadf);
background-size:400% 400%;
animation:bg 18s infinite alternate;
color:#fff
}
@keyframes bg{0%{background-position:0%}100%{background-position:100%}}
.hidden{display:none}

.center{
min-height:100vh;
display:flex;
align-items:center;
justify-content:center
}
.authCard{
width:92%;
max-width:380px;
background:rgba(0,0,0,0.35);
padding:24px;
border-radius:16px;
display:flex;
flex-direction:column;
gap:12px
}
.authTitle{
text-align:center;
font-size:22px;
font-weight:700
}
.input{
padding:12px;
border-radius:12px;
border:none;
outline:none
}
.btn{
padding:12px;
border-radius:12px;
border:none;
font-weight:700;
cursor:pointer
}
.primary{background:#fff;color:#000}
.link{
background:transparent;
border:1px solid rgba(255,255,255,0.25);
color:#fff
}

.container{
max-width:720px;
margin:0 auto;
padding:16px
}
.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:12px
}
.feed{display:flex;flex-direction:column;gap:16px}
.empty{text-align:center;opacity:0.8;padding:40px}
</style>
</head>
<body>

<div id="authPage" class="center">
  <div class="authCard">
    <div class="authTitle">SilentNotes</div>
    <input id="username" class="input" placeholder="Username">
    <input id="password" type="password" class="input" placeholder="Password">
    <button id="loginBtn" class="btn primary">Accedi</button>
    <button id="registerBtn" class="btn link">Registrati</button>
    <div id="authMsg" style="text-align:center;font-size:13px"></div>
  </div>
</div>

<div id="homePage" class="hidden">
  <div class="container">
    <div class="header">
      <div style="font-weight:700">SilentNotes Videos</div>
      <div>
        <button id="uploadBtn" class="btn primary">Carica video</button>
        <button id="logoutBtn" class="btn link">Logout</button>
      </div>
    </div>

    <div id="feed" class="feed">
      <div class="empty">Nessun video</div>
    </div>
  </div>
</div>

<script>
let token = localStorage.getItem('sn_token') || null

const authPage = document.getElementById('authPage')
const homePage = document.getElementById('homePage')
const authMsg = document.getElementById('authMsg')

function showHome(){
  authPage.classList.add('hidden')
  homePage.classList.remove('hidden')
  loadVideos()
}

function showAuth(){
  homePage.classList.add('hidden')
  authPage.classList.remove('hidden')
}

async function api(path, data){
  const r = await fetch(path,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  })
  return {ok:r.ok, data:await r.json()}
}

document.getElementById('loginBtn').onclick = async ()=>{
  const u=username.value.trim()
  const p=password.value
  if(!u||!p){authMsg.textContent='Compila tutti i campi';return}
  const r=await api('/auth/login',{username:u,password:p})
  if(!r.ok){authMsg.textContent=r.data.error||'Errore';return}
  localStorage.setItem('sn_token',r.data.token)
  showHome()
}

document.getElementById('registerBtn').onclick = async ()=>{
  const u=username.value.trim()
  const p=password.value
  if(!u||!p){authMsg.textContent='Compila tutti i campi';return}
  const r=await api('/auth/register',{username:u,password:p,displayName:u})
  if(!r.ok){authMsg.textContent=r.data.error||'Errore';return}
  localStorage.setItem('sn_token',r.data.token)
  showHome()
}

document.getElementById('logoutBtn').onclick = ()=>{
  localStorage.removeItem('sn_token')
  showAuth()
}

async function loadVideos(){
  const r = await fetch('/api/videos')
  const j = await r.json()
  const feed=document.getElementById('feed')
  feed.innerHTML=''
  if(!j.videos||!j.videos.length){
    feed.innerHTML='<div class="empty">Nessun video</div>'
    return
  }
}

if(token) showHome()
</script>
</body>
</html>

